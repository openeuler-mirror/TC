---
标题:     openEuler软件质量分级&执行策略
类别:     流程设计
摘要:     软件质量分级策略
作者:     范佳臣@disnight (fanjiachen3 at huawei.com)
状态:     初始化
编号:     oEEP-0014
创建日期: 2023-10-14
修订日期: 2023-10-14
---

## 背景/动机/目标/原则
随着社区的逐步发展，SIG，社区软件包逐步丰富，对社区软件的各种分层策略逐步产生，如软件[兼容性分层](https://gitee.com/openeuler/oec-application/blob/master/doc/compatibility_level.md)，[软件发布分层(BaseOS/everything/EPOL/multiver)](https://gitee.com/openeuler/release-management/tree/master/openEuler-22.03-LTS-SP2)等

综上所述，为减少开发者对各类标准的学习成本，同时统一入口标准，做实核心软件质量，删减部分扩展软件包的要求。故结合各要求及标准，讨论并推广社区的质量分级策略，并最终由QA&Packing 2个sig协同完成社区标准及工具体系的落地。
## 对 openEuler 的益处
* 质量分层：以镜像发布范围为主干（BaseOS/Everything/EPOL），仅对BaseOS范围进行质量分级细化，其余Everything及EPOL范围基于发布范围统一要求与标准，减少生态开发者的学习成本。
* 标准与要求统一：基于社区质量要求现状，明确维护、兼容性、测试要求，让社区参与者对发布版本要求有据可查。

## 方案描述 

### 软件包分层策略
|分层|特征|举例|
|:-|:-----|:-|
|L1|运行在数据面的关键软件；运行在控制面、管理面，可能会导致现网事故的组件（如升级相关软件等）；处于攻击路径的开源软件|openssh、dpdk|
|L2|运行在控制面、管理面，常驻系统或高频执行的软件，且社区活跃|systemd|
|L3|社区成熟，运行在管理面，使用频率低且功能稳定|bash、vim|
|L4|不在生产环境运行的软件。如：工具类软件|make|

### 软件包分层质量策略
|分层|维护要求|发布目录要求|兼容性要求|测试要求|
|:-|:----|:--|:---|:----|
| L1 | 1. 例行<font color="#0000dd">按周</font>同步社区补丁/按<font color="#0000dd">牵引SLA</font>进行修复<br>2. maintainer/committer梳理代码关键流程，有自维护自演进能力；回馈上有社区，建立上游影响力 | <font color="#dd0000">BaseOS</font> | 软件包及API、ABI在某个LTS版本的生命周期保持不变，<font color="#0000dd">跨LTS版本不保证兼容性</font> | 1. 基于开源测试套开展测试<br>2. 补充专项/DFX测试 |
| L2 | 1. 例行<font color="#0000dd">按双周</font>同步社区补丁<br>2. 漏洞按<font color="#0000dd">牵引SLA</font> | <font color="#dd0000">BaseOS</font> | 软件包及API、ABI在某个SP版本的生命周期保持不变，<font color="#0000dd">跨SP版本不保证兼容性</font> | 1. 基于开源测试套开展测试<br>2. 结合使用场景测试 |
| L3 | 1. 例行<font color="#00000dd">按月</font>同步社区补丁<br>2. 漏洞按<font color="#0000dd">牵引SLA</font> | <font color="#dd00000">BaseOS</font> | 不做兼容性保证 | 1. 基于开源测试套开展测试 |
| L4 | 1. 例行<font color="#00000dd">按月</font>同步社区高危漏洞/关键BUG | <font color="#0000dd">Everything</font> | 不做兼容性保证 | 1. 基于开源测试套开展测试 |
| 不涉及 | 1. 被动响应社区漏洞BUG | EPOL | 不做兼容性保证 | 1. 保障RPM维度功能可用 |

## 实施计划

### 活动-软件包引入
| 活动属性 | 内容 |
|:------|:---|
| 活动名称 | 软件包引入 |
| 活动描述 | 新增软件包建仓，创建分支，并在对应src-openEuler仓库提交源码 |
| 操作说明 | 1. 由 开发者 向openEuler/community提交软件包引入pr，pr内容见输入1<br>2. 由 TC、软件包归属sig的maintainer 检视PR并合入（该PR合入后，由工程能力自动创建 src-openEuler对应仓库<br>3. 由 开发者 向src-openEuler的对应仓库提交代码<br>4. 由 软件包归属sig的maintainer 检视PR并合入<br>5. 构建系统自动将该软件包变化获取，并应用至Factory构建工程构建 |
| 责任角色 | 软件包归属 sig （审批 软件包建仓；承接软件包维护责任） |
| 参与角色 | 包管理 sig （明确 软件包建仓、RPM源码编码 规范）<br>TC sig（审批及合入 软件包建仓）<br>开发者（主导建仓，代码初始化的操作） |
| 输入 | 1. 软件包配置表（包名、upstream信息、分支信息、归属sig信息）<br>2. 软件包源码（spec、源码、patch及其他文件） |
| 输出 | 无 |


### 活动-软件进入版本软件池
| 活动属性 | 内容 |
|:------|:---|
| 活动名称 | 软件进入版本软件池（即Factory -> Epol/Mainline） |
| 活动描述 | 新增软件包建仓后，在Factory工程构建稳定且成功安装后，挪入至（Mainline、Epol等）正式版本软件工程 |
| 操作说明 | 1. 由 包管理 sig 基于Factory工程内软件包 构建情况。定期（建议按季度）整理可进入版本软件池清单，并通知 软件包归属sig<br>2. 软件包归属 sig 基于 步骤1的清单，决策软件包是否纳入版本，软件包的质量级别。由质量级别明确纳入分支，最终向 openEuler/release-management仓库提交pr<br>3. RM sig的maintainer 检视PR并合入（纳入ISO范围内的软件包，需要有明确的维护committer）<br>4. 构建系统自动将PR变更在工程中应用，完成软件包的构建工程变更 |
| 责任角色 | 软件包归属 sig （主导移仓的操作） |
| 参与角色 | 包管理 sig （检查 符合规则的软件包范围  提醒对应sig迁移）<br>RM sig（审批及合入 软件包工程变更）<br>CICD sig （定义配置文件规范，落地配置与构建系统的工程能力） |
| 输入 | 1. 软件包版本信息（质量级别，构建工程，维护committer）<br>2. 版本软件范围基线 |
| 输出 | 无 |

### 活动-版本软件基线
| 活动属性 | 内容 |
|:------|:---|
| 活动名称 | 版本软件基线（即 创新版本、LTS首版本、LTS-SP版本 软件包范围基线） |
| 活动描述 | 在社区版本release-plan过程中分支全量Build前，明确软件版本范围；版本启动阶段的基线，版本发布阶段的软件退出 |
| 操作说明 | 1. 由 包管理 sig 基于版本软件池（创新版本/LTS首版本 对应 Mainline、EPOL工程， LTS-SP版本 对应 LTS-Next相关工程）程内软件包 构建情况。整理可进入版本软件池清单，并提交PR至 openEuler/community创建版本分支，openEuler/release-management 创建工程<br>2. TC 检视分支创建PR并合入，RM-sig 检视工程创建PR并合入<br>3. 社区CI自动基于 分支创建PR，在src-openEuler创建分支；构建系统自动基于 工程创建PR，在构建系统生成构建工程<br>4. 包管理 sig 持续跟踪版本软件包情况，在发布阶段 提出版本软件范围 变更建议。 |
| 责任角色 | 包管理 sig（主导并明确 版本软件包基线） |
| 参与角色 | RM sig（审批及合入 工程创建PR）<br>TC sig （审批及合入 分支创建PR）<br>CICD sig （定义配置文件规范，落地配置与构建系统的工程能力） |
| 输入 | 1. 版本软件范围基线 |
| 输出 | 无 |

### 活动-版本软件选型升级
| 活动属性 | 内容 |
|:------|:---|
| 活动名称 | 版本软件选型升级 |
| 活动描述 | 在版本发布计划间期内，对版本软件池内的软件进行选型升级与衰退 |
| 操作说明 | 1. 由 包管理 sig 版本基于版本分支范围。定期（建议按季度）整理软件包上游信息，并通过issue通知 软件包归属sig 软件包升级/衰退 建议<br>2. 软件包归属 sig 基于 步骤1的清单，决策软件包是否升级/衰退。若升级，则提交升级PR，并完成升级差异分析并提交PR；若衰退，则完成版本内依赖截断/替换，并在社区邮件进行公示，将衰退软件包sig变更至 recycle<br>3. 升级PR由 软件包归属sig 检视PR并合入<br>4. 衰退的 sig变更PR（sig 迁移至recycle） 由TC 检视PR并合入。若软件衰退影响版本构建，包管理 sig有权 组织 软件包归属sig讨论，并在一定限度内延长维护期限 |
| 责任角色 | 软件包 sig（开发 基于选件建议进行包升级） |
| 参与角色 | 包管理 sig（基于软件上游信息 提供选型与退出建议）<br>TC sig（审批及合入 软件包进入 recycle sigPR）|
| 输入 | 1. 软件包选型建议（升级版本 or 衰退建议） |
| 输出 | 无 |

### 活动-维护版本质量跟踪&质量分级变更建议
| 活动属性 | 内容 |
|:------|:---|
| 活动名称 | 维护版本质量跟踪&质量分级变更建议 |
| 活动描述 | 在LTS及LTS-SP的持续维护阶段，基于软件包质量分级，持续关注软件包质量满足情况 |
| 操作说明 | 1. 由 包管理 sig 基于版本软件基线。审视 CVE漏洞修复、bugfix、issue清零 等核心指标。对不满足质量要求的软件进行统计与社区范围的公示<br> 2.由 包管理 sig 组织 RM、QA及软件包归属sig讨论不满足质量分级的软件后续处理策略进行讨论。（维护主体变更、质量降级及工程变更、软件衰退）。持续3月无改进，则进行质量降级；持续6月无改进，社区公示1月后进行软件包衰退 |
| 责任角色 | 包管理 sig（主导 并审视版本软件质量满足度） |
| 参与角色 | RM sig（审批及合入 发布范围变更PR）<br>TC sig （审批及合入 软件包衰退PR） |
| 输入 | 1. 维护版本软件范围及质量满足情况（不满足的软件清单 与 整改建议） |
| 输出 | 无 |

## 文档链接  

- [兼容性分层](https://gitee.com/openeuler/oec-application/blob/master/doc/compatibility_level.md)
- [软件发布分层(BaseOS/everything/EPOL/multiver)](https://gitee.com/openeuler/release-management/tree/master/openEuler-22.03-LTS-SP2)